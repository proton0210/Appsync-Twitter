"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DataBaseStack = void 0;
const NotificationsTable_1 = require("./Constructs/NotificationsTable");
const RelationshipsTable_1 = require("./Constructs/RelationshipsTable");
const RetweetsTable_1 = require("./Constructs/RetweetsTable");
const LikesTable_1 = require("./Constructs/LikesTable");
const TweetsTable_1 = require("./Constructs/TweetsTable");
const cdk = require("aws-cdk-lib");
const eventsources = require("aws-cdk-lib/aws-lambda-event-sources");
const UsersTable_1 = require("./Constructs/UsersTable");
const TimelinesTable_1 = require("./Constructs/TimelinesTable");
const ConversationTable_1 = require("./Constructs/ConversationTable");
const DirectMessagesTable_1 = require("./Constructs/DirectMessagesTable");
class DataBaseStack extends cdk.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        this.props = props;
        this.initialize();
    }
    initialize() {
        this.initializeUserTableWithAccess();
        this.initializeTweetsTableWithAccess();
        this.initializeTimeLinesTableWithAccess();
        this.initializeLikesTableWithAccess();
        this.initializeRetweetTableWithAccess();
        this.initializeRelationshipsTableWithAccess();
        this.initializeNotificationTableWithAccess();
        this.initializeConversationsTableWithAccess();
        this.initializeDirectMessagesTableWithAccess();
    }
    initializeUserTableWithAccess() {
        this.usersTable = new UsersTable_1.UsersTable(this, 'UsersTable');
        this.usersTable.table.grantFullAccess(this.props.postConfirmationHook);
        this.props.syncUserstoAlgolia.addEventSource(new eventsources.DynamoEventSource(this.usersTable.table, {
            startingPosition: cdk.aws_lambda.StartingPosition.LATEST
        }));
    }
    initializeTweetsTableWithAccess() {
        this.tweetsTable = new TweetsTable_1.TweetsTable(this, 'TweetsTable');
        this.tweetsTable.table.grantFullAccess(this.props.distributeTweetWithFollowers);
        this.props.distributedTweet.addEventSource(new eventsources.DynamoEventSource(this.tweetsTable.table, {
            startingPosition: cdk.aws_lambda.StartingPosition.LATEST
        }));
        this.props.syncTweetsToAlgolia.addEventSource(new eventsources.DynamoEventSource(this.tweetsTable.table, {
            startingPosition: cdk.aws_lambda.StartingPosition.LATEST
        }));
        this.props.Notify.addEventSource(new eventsources.DynamoEventSource(this.tweetsTable.table, {
            startingPosition: cdk.aws_lambda.StartingPosition.LATEST
        }));
    }
    initializeTimeLinesTableWithAccess() {
        this.timelinesTable = new TimelinesTable_1.TimelinesTable(this, 'TimelinesTable');
        this.timelinesTable.table.grantFullAccess(this.props.distributedTweet);
        this.timelinesTable.table.grantFullAccess(this.props.distributeTweetWithFollowers);
    }
    initializeLikesTableWithAccess() {
        this.likesTable = new LikesTable_1.LikesTable(this, 'LikesTable');
        // add event source
        this.props.NotifyLiked.addEventSource(new eventsources.DynamoEventSource(this.likesTable.table, {
            startingPosition: cdk.aws_lambda.StartingPosition.LATEST
        }));
    }
    initializeRetweetTableWithAccess() {
        this.retweetTable = new RetweetsTable_1.RetweetsTable(this, 'RetweetsTable');
    }
    initializeRelationshipsTableWithAccess() {
        this.relationShipsTable = new RelationshipsTable_1.RelationshipsTable(this, 'RelationshipsTable');
        this.relationShipsTable.table.grantFullAccess(this.props.distributedTweet);
        this.relationShipsTable.table.grantFullAccess(this.props.distributeTweetWithFollowers);
        this.props.distributeTweetWithFollowers.addEventSource(new eventsources.DynamoEventSource(this.relationShipsTable.table, {
            startingPosition: cdk.aws_lambda.StartingPosition.LATEST
        }));
    }
    initializeNotificationTableWithAccess() {
        this.notificationsTable = new NotificationsTable_1.NotificationTable(this, 'NotificationTable');
    }
    initializeConversationsTableWithAccess() {
        this.conversationsTable = new ConversationTable_1.ConversationsTable(this, 'ConversationTable');
    }
    initializeDirectMessagesTableWithAccess() {
        this.directMessagesTable = new DirectMessagesTable_1.DirectMessagesTable(this, 'DirectMessagesTable');
    }
}
exports.DataBaseStack = DataBaseStack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWJhc2Utc3RhY2suanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJkYXRhYmFzZS1zdGFjay50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSx3RUFBb0U7QUFDcEUsd0VBQXFFO0FBQ3JFLDhEQUEyRDtBQUMzRCx3REFBcUQ7QUFDckQsMERBQXVEO0FBRXZELG1DQUFtQztBQUNuQyxxRUFBcUU7QUFFckUsd0RBQXFEO0FBQ3JELGdFQUE2RDtBQUM3RCxzRUFBb0U7QUFDcEUsMEVBQXVFO0FBRXZFLE1BQWEsYUFBYyxTQUFRLEdBQUcsQ0FBQyxLQUFLO0lBWTFDLFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBeUI7UUFDakUsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDeEIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbkIsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQ3BCLENBQUM7SUFFRCxVQUFVO1FBQ1IsSUFBSSxDQUFDLDZCQUE2QixFQUFFLENBQUM7UUFDckMsSUFBSSxDQUFDLCtCQUErQixFQUFFLENBQUM7UUFDdkMsSUFBSSxDQUFDLGtDQUFrQyxFQUFFLENBQUM7UUFDMUMsSUFBSSxDQUFDLDhCQUE4QixFQUFFLENBQUM7UUFDdEMsSUFBSSxDQUFDLGdDQUFnQyxFQUFFLENBQUM7UUFDeEMsSUFBSSxDQUFDLHNDQUFzQyxFQUFFLENBQUM7UUFDOUMsSUFBSSxDQUFDLHFDQUFxQyxFQUFFLENBQUM7UUFDN0MsSUFBSSxDQUFDLHNDQUFzQyxFQUFFLENBQUM7UUFDOUMsSUFBSSxDQUFDLHVDQUF1QyxFQUFFLENBQUM7SUFDakQsQ0FBQztJQUVELDZCQUE2QjtRQUMzQixJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksdUJBQVUsQ0FBQyxJQUFJLEVBQUUsWUFBWSxDQUFDLENBQUM7UUFDckQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsb0JBQW9CLENBQUMsQ0FBQztRQUN2RSxJQUFJLENBQUMsS0FBSyxDQUFDLGtCQUFrQixDQUFDLGNBQWMsQ0FDMUMsSUFBSSxZQUFZLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUU7WUFDeEQsZ0JBQWdCLEVBQUUsR0FBRyxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNO1NBQ3pELENBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQztJQUVELCtCQUErQjtRQUM3QixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUkseUJBQVcsQ0FBQyxJQUFJLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFDeEQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsZUFBZSxDQUNwQyxJQUFJLENBQUMsS0FBSyxDQUFDLDRCQUE0QixDQUN4QyxDQUFDO1FBQ0YsSUFBSSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxjQUFjLENBQ3hDLElBQUksWUFBWSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFO1lBQ3pELGdCQUFnQixFQUFFLEdBQUcsQ0FBQyxVQUFVLENBQUMsZ0JBQWdCLENBQUMsTUFBTTtTQUN6RCxDQUFDLENBQ0gsQ0FBQztRQUVGLElBQUksQ0FBQyxLQUFLLENBQUMsbUJBQW1CLENBQUMsY0FBYyxDQUMzQyxJQUFJLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRTtZQUN6RCxnQkFBZ0IsRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDLE1BQU07U0FDekQsQ0FBQyxDQUNILENBQUM7UUFFRixJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQzlCLElBQUksWUFBWSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFO1lBQ3pELGdCQUFnQixFQUFFLEdBQUcsQ0FBQyxVQUFVLENBQUMsZ0JBQWdCLENBQUMsTUFBTTtTQUN6RCxDQUFDLENBQ0gsQ0FBQztJQUNKLENBQUM7SUFFRCxrQ0FBa0M7UUFDaEMsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLCtCQUFjLENBQUMsSUFBSSxFQUFFLGdCQUFnQixDQUFDLENBQUM7UUFDakUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUN2RSxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQ3ZDLElBQUksQ0FBQyxLQUFLLENBQUMsNEJBQTRCLENBQ3hDLENBQUM7SUFDSixDQUFDO0lBRUQsOEJBQThCO1FBQzVCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSx1QkFBVSxDQUFDLElBQUksRUFBRSxZQUFZLENBQUMsQ0FBQztRQUNyRCxtQkFBbUI7UUFDbkIsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsY0FBYyxDQUNuQyxJQUFJLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRTtZQUN4RCxnQkFBZ0IsRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDLE1BQU07U0FDekQsQ0FBQyxDQUNILENBQUM7SUFDSixDQUFDO0lBQ0QsZ0NBQWdDO1FBQzlCLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSw2QkFBYSxDQUFDLElBQUksRUFBRSxlQUFlLENBQUMsQ0FBQztJQUMvRCxDQUFDO0lBRUQsc0NBQXNDO1FBQ3BDLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLHVDQUFrQixDQUM5QyxJQUFJLEVBQ0osb0JBQW9CLENBQ3JCLENBQUM7UUFDRixJQUFJLENBQUMsa0JBQWtCLENBQUMsS0FBSyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDM0UsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxlQUFlLENBQzNDLElBQUksQ0FBQyxLQUFLLENBQUMsNEJBQTRCLENBQ3hDLENBQUM7UUFDRixJQUFJLENBQUMsS0FBSyxDQUFDLDRCQUE0QixDQUFDLGNBQWMsQ0FDcEQsSUFBSSxZQUFZLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssRUFBRTtZQUNoRSxnQkFBZ0IsRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDLE1BQU07U0FDekQsQ0FBQyxDQUNILENBQUM7SUFDSixDQUFDO0lBRUQscUNBQXFDO1FBQ25DLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLHNDQUFpQixDQUFDLElBQUksRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO0lBQzdFLENBQUM7SUFFRCxzQ0FBc0M7UUFDcEMsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksc0NBQWtCLENBQUMsSUFBSSxFQUFFLG1CQUFtQixDQUFDLENBQUM7SUFDOUUsQ0FBQztJQUVELHVDQUF1QztRQUNyQyxJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSx5Q0FBbUIsQ0FDaEQsSUFBSSxFQUNKLHFCQUFxQixDQUN0QixDQUFDO0lBQ0osQ0FBQztDQUNGO0FBbkhELHNDQW1IQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5vdGlmaWNhdGlvblRhYmxlIH0gZnJvbSAnLi9Db25zdHJ1Y3RzL05vdGlmaWNhdGlvbnNUYWJsZSc7XG5pbXBvcnQgeyBSZWxhdGlvbnNoaXBzVGFibGUgfSBmcm9tICcuL0NvbnN0cnVjdHMvUmVsYXRpb25zaGlwc1RhYmxlJztcbmltcG9ydCB7IFJldHdlZXRzVGFibGUgfSBmcm9tICcuL0NvbnN0cnVjdHMvUmV0d2VldHNUYWJsZSc7XG5pbXBvcnQgeyBMaWtlc1RhYmxlIH0gZnJvbSAnLi9Db25zdHJ1Y3RzL0xpa2VzVGFibGUnO1xuaW1wb3J0IHsgVHdlZXRzVGFibGUgfSBmcm9tICcuL0NvbnN0cnVjdHMvVHdlZXRzVGFibGUnO1xuaW1wb3J0IHsgRGF0YUJhc2VTdGFja1Byb3BzIH0gZnJvbSAnLi8uLi8uLi8uLi9JbnRlcmZhY2VzL2RhdGFiYXNlLWludGVyZmFjZSc7XG5pbXBvcnQgKiBhcyBjZGsgZnJvbSAnYXdzLWNkay1saWInO1xuaW1wb3J0ICogYXMgZXZlbnRzb3VyY2VzIGZyb20gJ2F3cy1jZGstbGliL2F3cy1sYW1iZGEtZXZlbnQtc291cmNlcyc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCB7IFVzZXJzVGFibGUgfSBmcm9tICcuL0NvbnN0cnVjdHMvVXNlcnNUYWJsZSc7XG5pbXBvcnQgeyBUaW1lbGluZXNUYWJsZSB9IGZyb20gJy4vQ29uc3RydWN0cy9UaW1lbGluZXNUYWJsZSc7XG5pbXBvcnQgeyBDb252ZXJzYXRpb25zVGFibGUgfSBmcm9tICcuL0NvbnN0cnVjdHMvQ29udmVyc2F0aW9uVGFibGUnO1xuaW1wb3J0IHsgRGlyZWN0TWVzc2FnZXNUYWJsZSB9IGZyb20gJy4vQ29uc3RydWN0cy9EaXJlY3RNZXNzYWdlc1RhYmxlJztcblxuZXhwb3J0IGNsYXNzIERhdGFCYXNlU3RhY2sgZXh0ZW5kcyBjZGsuU3RhY2sge1xuICBwdWJsaWMgdXNlcnNUYWJsZTogVXNlcnNUYWJsZTtcbiAgcHVibGljIHR3ZWV0c1RhYmxlOiBUd2VldHNUYWJsZTtcbiAgcHVibGljIHRpbWVsaW5lc1RhYmxlOiBUaW1lbGluZXNUYWJsZTtcbiAgcHVibGljIGxpa2VzVGFibGU6IExpa2VzVGFibGU7XG4gIHB1YmxpYyByZXR3ZWV0VGFibGU6IFJldHdlZXRzVGFibGU7XG4gIHB1YmxpYyByZWxhdGlvblNoaXBzVGFibGU6IFJlbGF0aW9uc2hpcHNUYWJsZTtcbiAgcHVibGljIG5vdGlmaWNhdGlvbnNUYWJsZTogTm90aWZpY2F0aW9uVGFibGU7XG4gIHB1YmxpYyBjb252ZXJzYXRpb25zVGFibGU6IENvbnZlcnNhdGlvbnNUYWJsZTtcbiAgcHVibGljIGRpcmVjdE1lc3NhZ2VzVGFibGU6IERpcmVjdE1lc3NhZ2VzVGFibGU7XG4gIHB1YmxpYyBwcm9wczogRGF0YUJhc2VTdGFja1Byb3BzO1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBEYXRhQmFzZVN0YWNrUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQsIHByb3BzKTtcbiAgICB0aGlzLnByb3BzID0gcHJvcHM7XG4gICAgdGhpcy5pbml0aWFsaXplKCk7XG4gIH1cblxuICBpbml0aWFsaXplKCkge1xuICAgIHRoaXMuaW5pdGlhbGl6ZVVzZXJUYWJsZVdpdGhBY2Nlc3MoKTtcbiAgICB0aGlzLmluaXRpYWxpemVUd2VldHNUYWJsZVdpdGhBY2Nlc3MoKTtcbiAgICB0aGlzLmluaXRpYWxpemVUaW1lTGluZXNUYWJsZVdpdGhBY2Nlc3MoKTtcbiAgICB0aGlzLmluaXRpYWxpemVMaWtlc1RhYmxlV2l0aEFjY2VzcygpO1xuICAgIHRoaXMuaW5pdGlhbGl6ZVJldHdlZXRUYWJsZVdpdGhBY2Nlc3MoKTtcbiAgICB0aGlzLmluaXRpYWxpemVSZWxhdGlvbnNoaXBzVGFibGVXaXRoQWNjZXNzKCk7XG4gICAgdGhpcy5pbml0aWFsaXplTm90aWZpY2F0aW9uVGFibGVXaXRoQWNjZXNzKCk7XG4gICAgdGhpcy5pbml0aWFsaXplQ29udmVyc2F0aW9uc1RhYmxlV2l0aEFjY2VzcygpO1xuICAgIHRoaXMuaW5pdGlhbGl6ZURpcmVjdE1lc3NhZ2VzVGFibGVXaXRoQWNjZXNzKCk7XG4gIH1cblxuICBpbml0aWFsaXplVXNlclRhYmxlV2l0aEFjY2VzcygpIHtcbiAgICB0aGlzLnVzZXJzVGFibGUgPSBuZXcgVXNlcnNUYWJsZSh0aGlzLCAnVXNlcnNUYWJsZScpO1xuICAgIHRoaXMudXNlcnNUYWJsZS50YWJsZS5ncmFudEZ1bGxBY2Nlc3ModGhpcy5wcm9wcy5wb3N0Q29uZmlybWF0aW9uSG9vayk7XG4gICAgdGhpcy5wcm9wcy5zeW5jVXNlcnN0b0FsZ29saWEuYWRkRXZlbnRTb3VyY2UoXG4gICAgICBuZXcgZXZlbnRzb3VyY2VzLkR5bmFtb0V2ZW50U291cmNlKHRoaXMudXNlcnNUYWJsZS50YWJsZSwge1xuICAgICAgICBzdGFydGluZ1Bvc2l0aW9uOiBjZGsuYXdzX2xhbWJkYS5TdGFydGluZ1Bvc2l0aW9uLkxBVEVTVFxuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgaW5pdGlhbGl6ZVR3ZWV0c1RhYmxlV2l0aEFjY2VzcygpIHtcbiAgICB0aGlzLnR3ZWV0c1RhYmxlID0gbmV3IFR3ZWV0c1RhYmxlKHRoaXMsICdUd2VldHNUYWJsZScpO1xuICAgIHRoaXMudHdlZXRzVGFibGUudGFibGUuZ3JhbnRGdWxsQWNjZXNzKFxuICAgICAgdGhpcy5wcm9wcy5kaXN0cmlidXRlVHdlZXRXaXRoRm9sbG93ZXJzXG4gICAgKTtcbiAgICB0aGlzLnByb3BzLmRpc3RyaWJ1dGVkVHdlZXQuYWRkRXZlbnRTb3VyY2UoXG4gICAgICBuZXcgZXZlbnRzb3VyY2VzLkR5bmFtb0V2ZW50U291cmNlKHRoaXMudHdlZXRzVGFibGUudGFibGUsIHtcbiAgICAgICAgc3RhcnRpbmdQb3NpdGlvbjogY2RrLmF3c19sYW1iZGEuU3RhcnRpbmdQb3NpdGlvbi5MQVRFU1RcbiAgICAgIH0pXG4gICAgKTtcblxuICAgIHRoaXMucHJvcHMuc3luY1R3ZWV0c1RvQWxnb2xpYS5hZGRFdmVudFNvdXJjZShcbiAgICAgIG5ldyBldmVudHNvdXJjZXMuRHluYW1vRXZlbnRTb3VyY2UodGhpcy50d2VldHNUYWJsZS50YWJsZSwge1xuICAgICAgICBzdGFydGluZ1Bvc2l0aW9uOiBjZGsuYXdzX2xhbWJkYS5TdGFydGluZ1Bvc2l0aW9uLkxBVEVTVFxuICAgICAgfSlcbiAgICApO1xuXG4gICAgdGhpcy5wcm9wcy5Ob3RpZnkuYWRkRXZlbnRTb3VyY2UoXG4gICAgICBuZXcgZXZlbnRzb3VyY2VzLkR5bmFtb0V2ZW50U291cmNlKHRoaXMudHdlZXRzVGFibGUudGFibGUsIHtcbiAgICAgICAgc3RhcnRpbmdQb3NpdGlvbjogY2RrLmF3c19sYW1iZGEuU3RhcnRpbmdQb3NpdGlvbi5MQVRFU1RcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIGluaXRpYWxpemVUaW1lTGluZXNUYWJsZVdpdGhBY2Nlc3MoKSB7XG4gICAgdGhpcy50aW1lbGluZXNUYWJsZSA9IG5ldyBUaW1lbGluZXNUYWJsZSh0aGlzLCAnVGltZWxpbmVzVGFibGUnKTtcbiAgICB0aGlzLnRpbWVsaW5lc1RhYmxlLnRhYmxlLmdyYW50RnVsbEFjY2Vzcyh0aGlzLnByb3BzLmRpc3RyaWJ1dGVkVHdlZXQpO1xuICAgIHRoaXMudGltZWxpbmVzVGFibGUudGFibGUuZ3JhbnRGdWxsQWNjZXNzKFxuICAgICAgdGhpcy5wcm9wcy5kaXN0cmlidXRlVHdlZXRXaXRoRm9sbG93ZXJzXG4gICAgKTtcbiAgfVxuXG4gIGluaXRpYWxpemVMaWtlc1RhYmxlV2l0aEFjY2VzcygpIHtcbiAgICB0aGlzLmxpa2VzVGFibGUgPSBuZXcgTGlrZXNUYWJsZSh0aGlzLCAnTGlrZXNUYWJsZScpO1xuICAgIC8vIGFkZCBldmVudCBzb3VyY2VcbiAgICB0aGlzLnByb3BzLk5vdGlmeUxpa2VkLmFkZEV2ZW50U291cmNlKFxuICAgICAgbmV3IGV2ZW50c291cmNlcy5EeW5hbW9FdmVudFNvdXJjZSh0aGlzLmxpa2VzVGFibGUudGFibGUsIHtcbiAgICAgICAgc3RhcnRpbmdQb3NpdGlvbjogY2RrLmF3c19sYW1iZGEuU3RhcnRpbmdQb3NpdGlvbi5MQVRFU1RcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuICBpbml0aWFsaXplUmV0d2VldFRhYmxlV2l0aEFjY2VzcygpIHtcbiAgICB0aGlzLnJldHdlZXRUYWJsZSA9IG5ldyBSZXR3ZWV0c1RhYmxlKHRoaXMsICdSZXR3ZWV0c1RhYmxlJyk7XG4gIH1cblxuICBpbml0aWFsaXplUmVsYXRpb25zaGlwc1RhYmxlV2l0aEFjY2VzcygpIHtcbiAgICB0aGlzLnJlbGF0aW9uU2hpcHNUYWJsZSA9IG5ldyBSZWxhdGlvbnNoaXBzVGFibGUoXG4gICAgICB0aGlzLFxuICAgICAgJ1JlbGF0aW9uc2hpcHNUYWJsZSdcbiAgICApO1xuICAgIHRoaXMucmVsYXRpb25TaGlwc1RhYmxlLnRhYmxlLmdyYW50RnVsbEFjY2Vzcyh0aGlzLnByb3BzLmRpc3RyaWJ1dGVkVHdlZXQpO1xuICAgIHRoaXMucmVsYXRpb25TaGlwc1RhYmxlLnRhYmxlLmdyYW50RnVsbEFjY2VzcyhcbiAgICAgIHRoaXMucHJvcHMuZGlzdHJpYnV0ZVR3ZWV0V2l0aEZvbGxvd2Vyc1xuICAgICk7XG4gICAgdGhpcy5wcm9wcy5kaXN0cmlidXRlVHdlZXRXaXRoRm9sbG93ZXJzLmFkZEV2ZW50U291cmNlKFxuICAgICAgbmV3IGV2ZW50c291cmNlcy5EeW5hbW9FdmVudFNvdXJjZSh0aGlzLnJlbGF0aW9uU2hpcHNUYWJsZS50YWJsZSwge1xuICAgICAgICBzdGFydGluZ1Bvc2l0aW9uOiBjZGsuYXdzX2xhbWJkYS5TdGFydGluZ1Bvc2l0aW9uLkxBVEVTVFxuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgaW5pdGlhbGl6ZU5vdGlmaWNhdGlvblRhYmxlV2l0aEFjY2VzcygpIHtcbiAgICB0aGlzLm5vdGlmaWNhdGlvbnNUYWJsZSA9IG5ldyBOb3RpZmljYXRpb25UYWJsZSh0aGlzLCAnTm90aWZpY2F0aW9uVGFibGUnKTtcbiAgfVxuXG4gIGluaXRpYWxpemVDb252ZXJzYXRpb25zVGFibGVXaXRoQWNjZXNzKCkge1xuICAgIHRoaXMuY29udmVyc2F0aW9uc1RhYmxlID0gbmV3IENvbnZlcnNhdGlvbnNUYWJsZSh0aGlzLCAnQ29udmVyc2F0aW9uVGFibGUnKTtcbiAgfVxuXG4gIGluaXRpYWxpemVEaXJlY3RNZXNzYWdlc1RhYmxlV2l0aEFjY2VzcygpIHtcbiAgICB0aGlzLmRpcmVjdE1lc3NhZ2VzVGFibGUgPSBuZXcgRGlyZWN0TWVzc2FnZXNUYWJsZShcbiAgICAgIHRoaXMsXG4gICAgICAnRGlyZWN0TWVzc2FnZXNUYWJsZSdcbiAgICApO1xuICB9XG59XG4iXX0=